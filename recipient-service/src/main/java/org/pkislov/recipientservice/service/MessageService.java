package org.pkislov.recipientservice.service;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.pkislov.recipientservice.dto.MessageDto;import org.springframework.amqp.rabbit.core.RabbitTemplate;import org.springframework.stereotype.Service;import java.io.IOException;import java.util.ArrayList;import java.util.Collections;import java.util.List;import java.util.Optional;@Slf4j@Service@RequiredArgsConstructorpublic class MessageService {    private final RabbitTemplate rabbitTemplate;    private final List<MessageDto> messageStore = Collections.synchronizedList(new ArrayList<>());    private final ObjectMapper objectMapper = new ObjectMapper();    public Optional<MessageDto> getMessageAndClean() {            if (!messageStore.isEmpty()) {                MessageDto message = messageStore.remove(0);                log.info("Retrieved and removed one message: {}", message);                return Optional.of(message);            }            log.info("No messages found.");            return Optional.empty();    }    public void receiveMessages() {        log.info("Scheduler running. Checking for only one message...");        var message = rabbitTemplate.receive("messageQueue");        if (message != null) {            try {                var messageDto = objectMapper.readValue(message.getBody(), MessageDto.class);                messageStore.add(messageDto);                log.info("Received and processed message: {}", messageDto);            } catch (IOException e) {                log.error("Failed to deserialize message: {}", new String(message.getBody()), e);            }        }    }}